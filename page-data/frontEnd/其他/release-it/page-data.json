{"componentChunkName":"component---src-templates-blog-post-js","path":"/frontEnd/其他/release-it/","result":{"data":{"site":{"siteMetadata":{"title":"HJGP技术知识库"}},"markdownRemark":{"id":"c5c83836-c60c-5554-bda2-3b4675982bb8","excerpt":"适用于自己发过包的小伙伴，对流程有了解的，可以简化一些流程的操作， 等 安装 配置 在  中添加配置，这一步完就算安装完毕，提前登录 npm 就可以使用 release-it 的 功能，如果要集成  自动打包发布到 npm 请继续 获取 npm 发包 token image-2021121411101505…","html":"<p>适用于自己发过包的小伙伴，对流程有了解的，可以简化一些流程的操作，<code class=\"language-text\">tag、release、publish npm</code> 等</p>\n<h2>安装</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> @release-it/conventional-changelog release-it <span class=\"token parameter variable\">-D</span></code></pre></div>\n<h2>配置</h2>\n<p>在 <code class=\"language-text\">package.json</code> 中添加配置，这一步完就算安装完毕，提前登录 npm 就可以使用 release-it 的<code class=\"language-text\">publish npm</code> 功能，如果要集成 <code class=\"language-text\">github action</code> 自动打包发布到 npm 请继续</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// name：对应npm发的包名</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"@fruits-chain/react-native-xiaoshu\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 在npm网页上显示</span>\n  <span class=\"token property\">\"repository\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"git\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://github.com/hjfruit/react-native-xiaoshu\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 在npm网页上显示</span>\n  <span class=\"token property\">\"bugs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://github.com/hjfruit/react-native-xiaoshu/issues\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 发布到哪一个源</span>\n  <span class=\"token property\">\"publishConfig\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"registry\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://registry.npmjs.org/\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"release-it\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 配置一些格式</span>\n    <span class=\"token property\">\"git\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"commitMessage\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"chore: release ${version}\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"tagName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"v${version}\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// 是否支持release</span>\n    <span class=\"token property\">\"github\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"release\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// 关闭则可以，本地发布</span>\n    <span class=\"token property\">\"npm\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"publish\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>获取 npm 发包 token</h2>\n<p><img src=\"https://tva1.sinaimg.cn/large/008i3skNly1gxd7fm91zdj307k0fbglr.jpg\" alt=\"image-20211214111015051\"></p>\n<p><img src=\"https://tva1.sinaimg.cn/large/008i3skNly1gxd7fzstj9j316f022glm.jpg\" alt=\"image-20211214111107892\"></p>\n<p>生成好的 access token 保存好后面在 github 中添加使用</p>\n<h2>项目设置 Actions secrets</h2>\n<p>在项目中的 Setting 中设置刚刚获取的 token，key 为 <code class=\"language-text\">NPM_TOKEN</code></p>\n<p><img src=\"https://tva1.sinaimg.cn/large/008i3skNly1gxd7ftswq0j30x10jj76d.jpg\" alt=\"image-20211214112045308\"></p>\n<h2>添加 github action</h2>\n<p>创建 <code class=\"language-text\">.github/workflows/tag.yml</code> ，workflows 下任何.yml 文件都会被视作 action，名字自己根据功能取</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Next release\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"*\"</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">publish-to-npm</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout release branch code\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Use Node.js\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">11</span>\n          <span class=\"token key atrule\">registry-url</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//registry.npmjs.org\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> build\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install <span class=\"token important\">&amp;&amp;</span> npm run build\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Publish to NPM\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm publish <span class=\"token punctuation\">|</span><span class=\"token punctuation\">|</span> true\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">NODE_AUTH_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.NPM_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h2>最后</h2>\n<p>最后完成的效果 <code class=\"language-text\">release-it</code> 帮助我们简化流程，github action 帮我们打包发包，省去登录，切换源操作，如果有安全要求可设置 tag 或者分支权限即可，最后又一个坑：组织下的包第一次发布要加 <code class=\"language-text\">npm publish --access public</code> ,建议先手动发一次</p>","frontmatter":{"title":"release-it","date":"2021-12-14","description":null,"author":"Ming"}},"previous":{"fields":{"slug":"/frontEnd/react/react学习资源汇总/"},"frontmatter":{"title":"React 学习资源汇总"}},"next":{"fields":{"slug":"/frontEnd/nodejs/Node.js-static-resource-server/"},"frontmatter":{"title":"Node.js 倒腾一个静态资源服务器"}}},"pageContext":{"id":"c5c83836-c60c-5554-bda2-3b4675982bb8","previousPostId":"d32f29f6-22e9-5577-a27b-d5b707f1cca8","nextPostId":"ede4ab32-b1a2-5fca-b659-333f79710b9b"}},"staticQueryHashes":["2841359383","3257411868"]}