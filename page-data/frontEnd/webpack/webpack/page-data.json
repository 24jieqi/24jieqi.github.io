{"componentChunkName":"component---src-templates-blog-post-js","path":"/frontEnd/webpack/webpack/","result":{"data":{"site":{"siteMetadata":{"title":"HJGP技术知识库"}},"markdownRemark":{"id":"8ceb6191-00e5-5aea-9221-1062aaad69e8","excerpt":"webpack 1.核心概念 entry：入口，webpack执行构建的第一步将从entry开始，可抽象成输入。 loader：模块转化器，用于把模块内容按照需求转换成新内容。webpack只认识.js和.json文件。 plugin：扩展插件，在webpack…","html":"<h2>webpack</h2>\n<h3>1.核心概念</h3>\n<ul>\n<li>entry：入口，webpack执行构建的第一步将从entry开始，可抽象成输入。</li>\n<li>loader：模块转化器，用于把模块内容按照需求转换成新内容。webpack只认识.js和.json文件。</li>\n<li>plugin：扩展插件，在webpack构建流程中的特定时机注入扩展逻辑来改变构建结果或做你想要的事情。做loader不能做的事情。</li>\n<li>output：输出结果，在webpack经过一系列处理并得出最终想要的代码后输出结果。</li>\n<li>chunk：代码块，一个chunk由多个模块组合而成，用于代码合并与分割。一般来说一个 chunk 对应一个 bundle。webpack配置中入口文件entry是chunk，入口文件以及它的依赖文件通过动态加载import()/require.ensure()出来的模块是chunk，通过SplitChunks抽取出的公有代码也是chunk。</li>\n<li>module：模块，在webpack里一切皆模块，一个模块对应着一个文件。webpack会从配置的entry开始递归找出所有依赖的模块。</li>\n<li>bundle：webpack最终输出的文件就是bundle。</li>\n<li>hash：是根据打包中所有的文件计算出的hash值，所有产出的资源hash都一样。</li>\n<li>chunkhash：代码块的hash，一般来说每个entry，都会产出一个chunk，每个chunk的chunkhash不一样。</li>\n<li>contenthash：文件内容的hash，只有文件本身内容变了，那么contenthash才会改变。</li>\n</ul>\n<h3>2.构建性能优化</h3>\n<h4>2.1查找并诊断性能瓶颈</h4>\n<ol>\n<li>构建速度分析：影响构建性能和开发效率。speed-measure-webpack-plugin</li>\n<li>构建体积分析：影响页面访问性能。webpack-bundle-analyzer</li>\n</ol>\n<h4>2.2构建性能优化常用方法</h4>\n<ol>\n<li>通过多进程加快构建速度。</li>\n<li>通过分包减小构建目标容量。</li>\n<li>减少构建目标加快构建速度。</li>\n</ol>\n<h4>2.3优化方法实际配置</h4>\n<h5>2.3.1tree shaking</h5>\n<p>在打包时移除掉javascript上下文中无用的代码，没有用到的代码，从而优化打包的结果。</p>\n<p>tree shaking注意：</p>\n<p>1、通过解构的方式获取方法，可以触发tree shaking</p>\n<p>2、必须采用ESM模块化语法</p>\n<p>3、同一文件的tree shaking有触发条件，条件就是mode=production</p>\n<p>4、可以在package.json里面添加一个配置sideEffects</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// util.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'add'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">sub</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sub'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// app.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>add<span class=\"token punctuation\">,</span>sub<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'util.js'</span>\n<span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">//打包后的文件里面只会有add方法，并不会有sub方法 </span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// package.json</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// false 代表对所有文件进行tree shaking</span>\n  <span class=\"token property\">\"sideEffects\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"*.css\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"*.less\"</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// 指定有副作用的文件，不做tree shaking</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h5>2.3.2dll</h5>\n<p>可以将共享，并且不经常改变的代码，抽取成一个共享的库。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// webpack.dll.config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">vue</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'vue'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vue-router'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'vuex'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>DllPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> dllPath<span class=\"token punctuation\">,</span> <span class=\"token string\">'[name]-manifest.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'[name]_[hash]'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">context</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token function\">cwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// webpack.config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// 告诉webpack哪些库不参与打包，同时使用时的名称也得变</span>\n  \t<span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>DllReferencePlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  \t<span class=\"token literal-property property\">context</span><span class=\"token operator\">:</span> __dirname<span class=\"token punctuation\">,</span>\n  \t<span class=\"token literal-property property\">manifest</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'./dll/vue-manifest.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// 将某个文件打包输出去，并在html中自动引入该资源</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">AddAssetHtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">filepath</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'./dll/vue.dll.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h5>2.3.3splitChunks</h5>\n<p>提取公共代码，防止代码被重复打包，拆分过大的js文件，合并零散的js文件。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">optimization</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">splitChunks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// webpack采用哪种方式来分离chunk async  initial  all</span>\n      <span class=\"token comment\">// async: 只选择通过import()异步加载的模块来分离chunks</span>\n      <span class=\"token comment\">// initial: 只从入口模块进行拆分</span>\n      <span class=\"token comment\">// all: 所有</span>\n      <span class=\"token literal-property property\">chunks</span><span class=\"token operator\">:</span><span class=\"token string\">'async'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 分离chunk的最小体积</span>\n      <span class=\"token literal-property property\">minSize</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 表示入口的最大并行请求数,同时有多个模块满足拆分规则,选择容量更大的chunks</span>\n      <span class=\"token literal-property property\">maxInitialRequests</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 用来限制异步请求中的最大并发请求数</span>\n      <span class=\"token literal-property property\">maxAsyncRequests</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 自定义 chunk 输出分组，符合条件的模块分配到相同的组</span>\n      <span class=\"token literal-property property\">cacheGroups</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">defaultVendors</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[\\\\/]node_modules[\\\\/]</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">priority</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">reuseExistingChunk</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'vendors'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 最小引用次数大于这个才进行分包</span>\n          <span class=\"token literal-property property\">minChunks</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 优先级，值越大，越先执行</span>\n          <span class=\"token literal-property property\">priority</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 当前块包含已经从主包中分离出来的模块，将被重用</span>\n          <span class=\"token literal-property property\">reuseExistingChunk</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">'default'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h5>2.3.4多进程打包</h5>\n<p>开启电脑的多个进程同时干一件事，速度更快，但请在特别耗时的操作中使用，因为开线程、线程通信都要花时间。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.js$</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">exclude</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">node_modules</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'thread-loader'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 开启多进程打包</span>\n            <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token literal-property property\">worker</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3>3.webpack4和webpack5</h3>\n<ol>\n<li>webpack5比webpack4的文件压缩策略更优，分割文件后的vendor体积缩小。</li>\n<li>webpack5缓存构建性能优于webpack4。</li>\n<li>webpack5缓存的功能显著优于webpack4。webpack5可以设置缓存文件的名字、位置、缓存方式等等，webpack4只有开启和关闭。</li>\n</ol>\n<h3>4.模块联邦</h3>\n<p>模块联邦可以将一个应用的包应用于另一个应用，动态使用另一个应用的模块，同时具备整体应用一起打包的公共依赖抽取能力。可以用来做微前端。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 主应用 app_b</span>\n<span class=\"token comment\">// webpack.config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">ModuleFederationPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'app_b.js'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'app_b'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 需要依赖的远程模块，用于引入外部其他模块</span>\n      <span class=\"token literal-property property\">remotes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">app_a</span><span class=\"token operator\">:</span> <span class=\"token string\">'app_a@http://localhost:3000/index.js'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// index.js</span>\n<span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'app_a/moduleA'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// const moduleA = res.default</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'主应用启动中'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 子应用 app_a</span>\n<span class=\"token comment\">// webpack.config.js</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">ModuleFederationPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 入口文件名称，用于对外提供模块时候的入口文件名</span>\n      <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'index.js'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 当前应用的名称，需要唯一性</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'app_a'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 需要导出的模块，用于提供给外部其他项目进行使用</span>\n      <span class=\"token literal-property property\">exposes</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string-property property\">'./moduleA'</span><span class=\"token operator\">:</span> <span class=\"token string\">'./index.js'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// index.js</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'子应用启动中'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'run'</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> run</code></pre></div>","frontmatter":{"title":"webpack 学习笔记","date":"2022-08-08","description":null,"author":"TT"}},"previous":{"fields":{"slug":"/frontEnd/css/cssModules/"},"frontmatter":{"title":"Css Modules"}},"next":{"fields":{"slug":"/frontEnd/demo/五子棋/"},"frontmatter":{"title":"使用 React 实现五子棋游戏（选修）"}}},"pageContext":{"id":"8ceb6191-00e5-5aea-9221-1062aaad69e8","previousPostId":"ea26f1e0-41b0-5fc3-935c-d13cb1e32af1","nextPostId":"e6a3376c-9cf0-56a8-b174-00dfab67385a"}},"staticQueryHashes":["2841359383","3257411868"]}